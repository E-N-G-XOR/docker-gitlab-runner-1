gitlab:
  image: gitlab/gitlab-ce
  container_name: gitlab
  hostname: gitlab.example.com
  ports:
    - "8443:443"
    - "8080:80"
    - "8022:22"
  volumes_from:
    - gitlab_data

gitlab_data:
  image: alpine
  command: /bin/true
  container_name: gitlab-data
  volumes:
    - /etc/gitlab
    - /var/log/gitlab
    - /var/opt/gitlab

gitlab_runner:
  build: .
  container_name: gitlab-runner
  env_file:
    - ./gitlab-runner.env
  environment:
    CI_SERVER_URL: http://gitlab.example.com:80/ci
    DOCKER_IMAGE: alpine
    RUNNER_EXECUTOR: docker
  links:
    - gitlab:gitlab.example.com
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock
